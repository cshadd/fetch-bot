<!DOCTYPE html>
<html itemtype="http://schema.org/WebPage" itemscope="" lang="en-US">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="IE_RM_OFF" content="false" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="includes/common.css" />
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="readCommunications.js"></script>
    <script>
        setInterval(function () {
            $("#ext-camera").attr("src", "comms/stream.png?refresh=" + new Date().getTime());
            if (data != null && data2 != null) {
                $("#connection-offline").hide();
                $("#status-curr-emotion").text("Current Emotion: " + data.emotion);
                $("#status-curr-mode").text("Current Mode: " + data.mode);
                $("#status-curr-rot").text("Current Rotation: " + data.rot + " Degrees");
                $("#status-curr-trackclass").text("Current Track Class: " + data.trackclass);
                $("#status-ultrasonic").text("Ultrasonic Sensor: " + data.ultrasonic + "cm");
                $("#status-verbose").text(data.verbose);

                if (data.mode == "Auto") {
                    $("#btn-auto").hide();
                    $("#btn-idle").show();
                    $("#btn-kill").show();
                    $("#btn-manual").show();
                    $("#controls-auto").show();
                    $("#controls-manual").hide();
                }
                else if (data.mode == "Manual") {
                    $("#btn-auto").show();
                    $("#btn-idle").show();
                    $("#btn-kill").show();
                    $("#btn-manual").hide();
                    $("#controls-auto").hide();
                    $("#controls-manual").show();
                }
                else if (data.mode == "Idle") {
                    $("#btn-auto").show();
                    $("#btn-idle").hide();
                    $("#btn-kill").show();
                    $("#btn-manual").show();
                    $("#controls-auto").hide();
                    $("#controls-manual").hide();
                }
                else {
                    $("#btn-auto").hide();
                    $("#btn-idle").hide();
                    $("#btn-kill").hide();
                    $("#btn-manual").hide();
                    $("#connection-offline").show();
                    $("#controls-auto").hide();
                    $("#controls-manual").hide();
                    $("#status-curr-emotion").text("Current Emotion:");
                    $("#status-curr-mode").text("Current Mode:");
                    $("#status-curr-rot").text("Current Rotation:");
                    $("#status-curr-trackclass").text("Current Track Class:");
                    $("#status-ultrasonic").text("Ultrasonic Sensor:");
                    $("#status-verbose").text("...");
                }
            }
            else {
                $("#btn-auto").hide();
                $("#btn-idle").hide();
                $("#btn-kill").hide();
                $("#btn-manual").hide();
                $("#connection-offline").show();
                $("#controls-auto").hide();
                $("#controls-manual").hide();
                $("#status-curr-emotion").text("Current Emotion:");
                $("#status-curr-mode").text("Current Mode:");
                $("#status-curr-rot").text("Current Rotation:");
                $("#status-curr-trackclass").text("Current Track Class:");
                $("#status-ultrasonic").text("Ultrasonic Sensor:");
                $("#status-verbose").text("...");
            }
        }, 1000);

        function sendToRobot() {
            $.ajax({
                type: "POST",
                url: "processRobot.php",
                dataType: "json",
                async: false,
                data: {
                    data: JSON.stringify(data2)
                },
                success: function () { }
            });
        }

        function setMode(mode) {
            data2.mode = mode;
            sendToRobot();
        }

        function setMove(direction) {
            data2.move = direction;
            sendToRobot();
        }

        function setObjectClass(){
            data2.trackclass = $("#txt-trackclass").val();
            $("#txt-trackclass").val("");
            sendToRobot();
        }

    </script>
    <title>Fetch Bot Web Interface</title>
</head>
<body>
    <main>
        <div id="connection-offline" class="alert alert-danger">
            <div class="progress">
                <div class="connection-progress-bar progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                    <p>Waiting for connection to robot.</p>
                </div>
            </div>
        </div>
        <img class="logo" src="https://cshadd.github.io/fetch-bot/Logo.png" alt="Fetch Bot" />
        <div class="row">
            <div class="col-sm-4">
                <iframe class="ext-display" src="face.html"></iframe>
            </div>
            <div class="col-sm-4">
                <h1>Fetch Bot Web Interface</h1>
                <hr />
                <form action="#" method="post">
                    <div class="panel panel-primary">
                        <div class="panel-heading">Status</div>
                        <div class="panel-body">
                            <p id="status-curr-mode"></p>
                            <p id="status-curr-trackclass"></p>
                            <p id="status-curr-emotion"></p>
                            <p id="status-curr-rot"></p>
                            <p id="status-ultrasonic"></p>
                            <input data-toggle="collapse" data-target="#status-verbose" class="btn btn-primary" type="button" value="Show/Hide Verbose" />
                            <div class="form-group">
                                <textarea id="status-verbose" class="collapse form-control" readonly="readonly"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="panel panel-primary">
                        <div class="panel-heading">Controls</div>
                        <div class="panel-body">
                            <input id="btn-kill" class="btn btn-danger" type="button" value="Kill" onclick="setMode('Off')" /><br /><br />
                            <input id="btn-auto" class="btn btn-warning" type="button" value="Auto" onclick="setMode('Auto')" />
                            <input id="btn-idle" class="btn btn-warning" type="button" value="Idle" onclick="setMode('Idle')" />
                            <input id="btn-manual" class="btn btn-warning" type="button" value="Manual" onclick="setMode('Manual')" /><br />
                            <div id="controls-auto">
                                <!-- TODO -->
                                <div class="form-group">
                                    <input id="txt-trackclass" class="form-control" type="text" />
                                </div>
                                <input id="btn-trackclass" class="btn btn-primary" type="button" value="Set Track Class" onclick="setObjectClass()" />
                            </div>
                            <div id="controls-manual">
                                <div class="row">
                                    <div class="col-sm-4">
                                        <input class="btn btn-primary move-button" type="button" name="move-left" value="Turn Left" onclick="setMove('Left')" />
                                    </div>
                                    <div class="col-sm-4">
                                        <input class="btn btn-primary move-button" type="button" name="move-forward" value="Move Forward" onclick="setMove('Forward')" />
                                    </div>
                                    <div class="col-sm-4">
                                        <input class="btn btn-primary move-button" type="button" name="move-right" value="Turn Right" onclick="setMove('Right')" />
                                    </div>
                                </div>
                                <br />
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-sm-4">
                <iframe id="ext-camera" class="ext-display" src=""></iframe>
            </div>
        </div>
        <br />
        <a href="https://www.raspberrypi.org/">
            <img src="https://www.raspberrypi.org/app/uploads/2017/06/Powered-by-Raspberry-Pi-Logo_Outline-Colour-Screen-500x153.png" alt="<3 Raspberry Pi" />
        </a>
    </main>
</body>
</html>
